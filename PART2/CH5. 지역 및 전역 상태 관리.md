>ğŸ’¡ **CHAPTER 5**
>
>- ë¦¬ì•¡íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœ ê´€ë¦¬ì— ìˆì–´ ì–´ë ¤ìš´ ì ì€ ë°ì´í„°ì˜ íë¦„ì´ ë‹¨ë°©í–¥ì´ë¼ëŠ” ê²ƒ. ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ëŠ” ìì‹ ì»´í¬ë„ŒíŠ¸ì—ê²Œ ìƒíƒœ ì „ë‹¬í•  ìˆ˜ ìˆì§€ë§Œ ë°˜ëŒ€ë¡œëŠ” ë¶ˆê°€ëŠ¥
>- ì§€ì—­ ìƒíƒœ ê´€ë¦¬
>- ì½˜í…ìŠ¤íŠ¸ APIë¥¼ ì‚¬ìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ ê´€ë¦¬

# 5-1. ì§€ì—­ ìƒíƒœ ê´€ë¦¬

ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœëŠ” ì»´í¬ë„ŒíŠ¸ ìŠ¤ì½”í”„ ìƒíƒœë¥¼ ì˜ë¯¸(ì§€ì—­ ìƒíƒœ), ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì—ì„œëŠ” ì§€ì—­ ìƒíƒœë§Œ ê´€ë¦¬í•˜ëŠ” ê²½ìš°ì´ë‹¤.

- **ì•„í†° ì»´í¬ë„ŒíŠ¸**

ë¹„êµì  ì‘ì€ í¬ê¸°ì˜ ì§€ì—­ ìƒíƒœë¥¼ ì‚¬ìš©í•  ë•Œ 

- **ë¡œë”© ìƒíƒœ**

http ì‘ë‹µ ëŒ€ê¸°

# 5-2. ì „ì—­ ìƒíƒœ ê´€ë¦¬

ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ê³µìœ í•˜ëŠ” ìƒíƒœ, ì–´ë–¤ ì»´í¬ë„ŒíŠ¸ë¼ë„ ì ‘ê·¼ ë° ìˆ˜ì •ì´ ê°€ëŠ¥í•œ ìƒíƒœ

- ë¼ì´ë¸ŒëŸ¬ë¦¬: Redux, Recoil, MobX
- ë¦¬ì•¡íŠ¸ ë‚´ë¶€: context API
- Apollo í´ë¼ì´ì–¸íŠ¸ì™€ ë©”ëª¨ë¦¬ ìºì‹œë¥¼ ì´ìš©
    - ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì „ì—­ ë°ì´í„°ë¥¼ ì •í˜•í™”ëœ ì§ˆì˜ì–¸ì–´ë¡œ ë‹¤ë£¬ë‹¤ëŠ” ìƒˆë¡œìš´ ê´€ì 

## ì¥ë°”êµ¬ë‹ˆ ê¸°ëŠ¥ êµ¬í˜„

1. ì‚¬ìš©ìê°€ ì¥ë°”êµ¬ë‹ˆì— í•˜ë‚˜ ì´ìƒì˜ ìƒí’ˆì„ ë‹´ìœ¼ë©´ ê·¸ ìˆ˜ë¥¼ ë‚´ë¹„ê²Œì´ì…˜ ë°”ì— ë³´ì—¬ì¤Œ
2. ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ë¬¼ê±´ì„ êµ¬ë§¤í•˜ê¸°ë¡œ ê²°ì •í•˜ë©´ í•´ë‹¹ ìƒí’ˆì„ ê²°ì œ í˜ì´ì§€ì— ë‚˜ì—´

> ì±…ì—ì„œëŠ” context APIì™€ ìˆœìˆ˜ redux ë‘ ê°€ì§€ ë²„ì „ìœ¼ë¡œ ì„¤ëª…í•˜ì˜€ìœ¼ë‚˜, reduxëŠ” ì‚¬ìš©í•´ë³´ì•˜ê³  context APIë¥¼ í•œ ë²ˆë„ ì‚¬ìš©í•´ ë³¸ ì ì´ ì—†ê¸°ì— context APIë§Œ ì •ë¦¬í•¨
> 

### context API

ëª…ì‹œì ìœ¼ë¡œ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì— ì†ì„±ê°’ í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•  í•„ìš” ì—†ìŒ, ìì‹ ì»´í¬ë„ŒíŠ¸ê°€ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ê²Œ ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ë„ ìˆë‹¤.

- data/items.js
    - ì„ íƒí•œ ìƒí’ˆì„ ì „ì—­ ìƒíƒœì— ì €ì¥í•  ë•ŒëŠ” ìƒíƒœë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ë¡œ ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©.
    - ê° ì†ì„±ì€ ìƒí’ˆ IDë¥¼ ì˜ë¯¸, ì‚¬ìš©ìê°€ ë‹´ì€ ìƒí’ˆì˜ ê°œìˆ˜

```jsx
// ì‚¬ìš©ìê°€ ë‹¹ê·¼ 4ê°œì™€ ì–‘íŒŒ 2ê°œë¥¼ ë‹´ì•˜ì„ ë•Œ ìƒíƒœ ê°ì²´
export const items = {
  carrot: 4,
  onion: 2,
};
```

- components/context/cartContext.js
    - ì¥ë°”êµ¬ë‹ˆë¥¼ ìœ„í•œ ì½˜í…ìŠ¤íŠ¸
    - ì¥ë°”êµ¬ë‹ˆë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ê°™ì€ ì½˜í…ìŠ¤íŠ¸ë¡œ ê°ì‹¼ë‹¤. â†’ Navbar.jsì»´í¬ë„ŒíŠ¸ë‚˜ ProductCard.jsì»´í¬ëŠ”íŠ¸ëŠ” ëª¨ë‘ ê°™ì€ ì½˜í…ìŠ¤íŠ¸ ë‚´ì— ë§ˆìš´íŠ¸ ë˜ì–´ì•¼ í•¨

```jsx
import { createContext } from 'react';

const ShoppingCartContext = createContext({
  items: {},
  setItems: () => null,
});

export default ShoppingCartContext;
```

- pages/_app.js
    - ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ê²½ìš°ì—ë„ ì „ì—­ ìƒíƒœë¥¼ ë™ì¼í•˜ê²Œ ìœ ì§€í•  ìˆ˜ ìˆë„ë¡ â†’ ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™í•´ì„œë„ ì‚¬ìš©ìê°€ ì„ íƒí•œ ë¬¼ê±´ê³¼ ìˆ˜ëŸ‰ í‘œì‹œ

```jsx
import { useState } from 'react';
import Head from 'next/head';
import ShoppingCartContext from '@/components/context/cartContext';
import Navbar from '../components/Navbar';

function MyApp({ Component, pageProps }) {
  const [items, setItems] = useState({});

  return (
    **<ShoppingCartContext.Provider value={{ items, setItems }}>
      <Navbar />
      <div className='w-9/12 m-auto pt-10'>
        <Component {...pageProps} />
      </div>
    </ShoppingCartContext.Provider>**
  );
}

export default MyApp;
```

- pages/index.js
    - ìƒí’ˆ ëª©ë¡ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê°€ì ¸ì˜´

```jsx
import ProductCard from '@/components/ProductCard';
import products from '@/data/products';

function Home() {
  return (
    <div className='grid grid-cols-4 gap-4'>
      {products.map((product) => (
        <ProductCard key={product.id} {...product} />
      ))}
    </div>
  );
}

export default Home;
```

- ProductCard ì»´í¬ë„ŒíŠ¸ì—ì„œ ì½˜í…ìŠ¤íŠ¸ ì‚¬ìš©í•˜ëŠ” ë°©ë²•

```jsx
import React from 'react';
import { useContext } from 'react';
import ShoppingCartContext from './context/cartContext';

function ProductCard({ id, name, price, picture }) {
  const { setItems, items } = useContext(ShoppingCartContext);  // context ì—°ê²°
  const productAmount = id in items ? items[id].amount : 0;     // ìƒí’ˆ ìˆ˜ëŸ‰ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ ë•Œ 

  return <div className='bg-gray-200 p-6 rounded-md'></div>;
}

export default ProductCard;
```

ì‚¬ìš©ìê°€ + ë²„íŠ¼ í´ë¦­í•  ë•Œë§ˆë‹¤ ì „ì—­ itemsìƒíƒœ ê°ì²´ì˜ ê°’ì´ ë°”ë€Œê³  ProductCard ì»´í¬ë„ŒíŠ¸ê°€ ì¬ë Œë”ë§ë˜ë©° ProductAmountìƒìˆ˜ê°’ì´ ìƒˆë¡œìš´ ê°’ìœ¼ë¡œ ë°”ë€Œê²Œ ë¨

- + ë˜ëŠ” -ë²„íŠ¼ í´ë¦­ ì‹œ ì²˜ë¦¬ ë°©ë²• ì½”ë“œ
1. incrementë¥¼ ì „ë‹¬í•´ì„œ í˜¸ì¶œí•˜ë©´ ìš°ì„  ì „ì—­ ìƒíƒœì— í•´ë‹¹ ìƒí’ˆì´ ìˆëŠ”ì§€ í™•ì¸, ì´ˆê¸° ì „ì—­ ìƒíƒœê°€ ê°’ì´ ì—†ëŠ” ë¹ˆ ê°ì²´ì¼ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ â†’ í•´ë‹¹ ìƒí’ˆì´ ì´ë¯¸ ìˆë‹¤ë©´ ìƒí’ˆ ìˆ˜ëŸ‰ í•˜ë‚˜ ëŠ˜ë¦¼
2. ìƒí’ˆì´ ì—†ë‹¤ë©´ items ê°ì²´ì— í•´ë‹¹ ìƒí’ˆì˜ IDë¥¼ í‚¤ ê°’ìœ¼ë¡œ ê°€ì§€ëŠ” ìƒˆë¡œìš´ ì†ì„±ì„ ì¶”ê°€ â†’ ê·¸ë¦¬ê³  ê·¸ ê°’ì„ 1ë¡œ ì§€ì •
3. ì¸ìê°€ decrementë¼ë©´ ë˜‘ê°™ì´ ì „ì—­ ìƒíƒœ ê°ì²´ì— í•´ë‹¹ ìƒí’ˆì´ ìˆëŠ”ì§€ í™•ì¸ â†’ ìƒí’ˆì´ ìˆê³  ìˆ˜ëŸ‰ì´ 0ë³´ë‹¤ í¬ë‹¤ë©´ ê°’ì—ì„œ 1ì„ ëºŒ â†’ ê·¸ ì™¸ì˜ ê²½ìš°ëŠ” ìƒí’ˆ ìˆ˜ëŸ‰ì´ -ê°€ ë  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ê·¸ëƒ¥ í•¨ìˆ˜ë¥¼ ì¢…ë£Œ

```jsx
import React from 'react';
import { useContext } from 'react';
import ShoppingCartContext from './context/cartContext';

function ProductCard({ id, name, price, picture }) {
  const { setItems, items } = useContext(ShoppingCartContext); // context ì—°ê²°
  const productAmount = items?.[id] ?? 0; // ìƒí’ˆ ìˆ˜ëŸ‰ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ ë•Œ ?? ì—°ì‚°ì

  const handleAmount = (action) => {
    if (action === 'increase') {
      const newItemAmount = id in items ? items[id] + 1 : 1;
      setItems({ ...items, [id]: newItemAmount });
    }
    if (action === 'decrease') {
      if (items?.[id] > 0) {
        setItems({ ...items, [id]: items[id] - 1 });
      }
    }
  };

  return (
    <div className='bg-gray-200 p-6 rounded-md'>
      <button onClick={() => handleAmount('decrease')}>-</button>
      <div>{productAmount}</div>
      <button onClick={() => handleAmount('increase')}>+</button>
    </div>
  );
}

export default ProductCard;
```

- Navbarì— ìƒí’ˆ ê°œìˆ˜ êµ¬í˜„
    - ì „ì—­ items ìƒíƒœ ê°ì²´ë¥¼ ìˆ˜ì •í•  ì¼ì´ ì—†ê¸° ë•Œë¬¸ì— setItems í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

```jsx
import { useContext } from 'react';
import Link from 'next/link';
import ShoppingCartContext from './context/cartContext';

function Navbar() {
  const { items } = useContext(ShoppingCartContext);
  const totalItems = Object.values(items).reduce(
    (acc, item) => acc + item.quantity,
    0,
  );

  return (
    <div>{totalItems}</div>
  )
}
```

- /pages/cart.js í˜ì´ì§€
    - ê²°ì œí•  ìƒí’ˆ ëª©ë¡ì„ í‘œì‹œí•˜ëŠ” í˜ì´ì§€ êµ¬í˜„

```jsx
import React from 'react';
import { useContext } from 'react';
import ShoppingCartContext from '@/components/context/cartContext';
import products from '@/data/items';

/**
 *
 * @param {string} id ìƒí’ˆ id
 * @returns ìƒí’ˆ idë¡œ í•´ë‹¹ ìƒí’ˆì˜ ì „ì²´ ì •ë³´ë¥¼ ë‹´ì€ ê°ì²´ ë°˜í™˜
 */
function getFullItem(id) {
  const idx = products.findIndex((item) => item.id === id);
  return products[idx];
}

function cart(props) {
  const { items } = useContext(ShoppingCartContext);
  const total = Object.keys(items)
    .map((id) => getFullItem(id).price * items[id])
    .reduce((acc, cur) => acc + cur, 0); // ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ìƒí’ˆì˜ ì „ì²´ ê°€ê²© ê³„ì‚°

  const amounts = Object.keys(items).map((id) => {
    const item = getFullItem(id);
    return { item, amount: items[id] }; // amountsë¼ëŠ” ë°°ì—´ì— ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ìƒí’ˆë“¤ì˜ ì •ë³´ì™€ ìƒí’ˆë³„ ìˆ˜ëŸ‰ì„ ë„£ìŒ
  });

  return (
    <div>
      <h1>Total: ${total}</h1>
      {amounts.map((item, amount) => {
        <div key={item.id}>
          x{amount} {item.name} (${amount * item.price})
        </div>;
      })}
    </div>
  );
}

export default cart;
```